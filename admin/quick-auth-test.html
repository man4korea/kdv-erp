<!DOCTYPE html>
<html lang="ko">
<!-- ğŸ“ admin/quick-auth-test.html
     ë¹ ë¥¸ ì¸ì¦ í…ŒìŠ¤íŠ¸ ë° ì„¤ì • ì§„ë‹¨
     Create at 250524_2200 Ver1.00 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹ ë¥¸ ì¸ì¦ í…ŒìŠ¤íŠ¸ - KDV ERP</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.success { background: #28a745; }
        
        .step {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        
        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ë¹ ë¥¸ ì¸ì¦ í…ŒìŠ¤íŠ¸ & ì§„ë‹¨</h1>
        <p>Firebase Authentication ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë¬¸ì œë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.</p>
        
        <button onclick="checkAuthConfig()" class="success">ğŸ” ì¸ì¦ ì„¤ì • í™•ì¸</button>
        <button onclick="tryDirectAuth()" class="warning">ğŸ§ª ì§ì ‘ ì¸ì¦ ì‹œë„</button>
        <button onclick="showManualSteps()">ğŸ“‹ ìˆ˜ë™ ì„¤ì • ê°€ì´ë“œ</button>
        <button onclick="clearResults()">ğŸ§¹ ê²°ê³¼ ì§€ìš°ê¸°</button>
        
        <div id="results"></div>
        
        <div id="manualSteps" style="display: none;">
            <div class="step">
                <h3>ğŸ“‹ Firebase Console ìˆ˜ë™ ì„¤ì • ê°€ì´ë“œ</h3>
                
                <h4>1ï¸âƒ£ Firebase Console ì ‘ì†</h4>
                <div class="code-block">https://console.firebase.google.com/</div>
                <p>Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ â†’ "kdv-sys" í”„ë¡œì íŠ¸ ì„ íƒ</p>
                
                <h4>2ï¸âƒ£ Authentication í™œì„±í™”</h4>
                <ul>
                    <li>ì™¼ìª½ ë©”ë‰´ â†’ "Authentication" í´ë¦­</li>
                    <li>"ì‹œì‘í•˜ê¸°" ë˜ëŠ” "Get started" ë²„íŠ¼ í´ë¦­</li>
                    <li>"Sign-in method" íƒ­ ì„ íƒ</li>
                    <li>"Email/Password" í•­ëª© í´ë¦­</li>
                    <li>"Enable" í† ê¸€ ì¼œê¸°</li>
                    <li>"Save" ë²„íŠ¼ í´ë¦­</li>
                </ul>
                
                <h4>3ï¸âƒ£ Firestore í™œì„±í™”</h4>
                <ul>
                    <li>ì™¼ìª½ ë©”ë‰´ â†’ "Firestore Database" í´ë¦­</li>
                    <li>"Create database" ë²„íŠ¼ í´ë¦­</li>
                    <li>"Start in test mode" ì„ íƒ</li>
                    <li>Location: "asia-northeast3 (Seoul)" ì„ íƒ</li>
                    <li>"Done" í´ë¦­</li>
                </ul>
                
                <h4>4ï¸âƒ£ ì„¤ì • ì™„ë£Œ í›„</h4>
                <p>ìœ„ì˜ "ğŸ” ì¸ì¦ ì„¤ì • í™•ì¸" ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { 
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc,
            serverTimestamp
        } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAfSlSi4pNlKvMU-NBpQ3ZWSeG4QNpZiCk",
            authDomain: "kdv-sys.firebaseapp.com",
            projectId: "kdv-sys",
            storageBucket: "kdv-sys.firebasestorage.app",
            messagingSenderId: "352925761129",
            appId: "1:352925761129:web:a9c9cf2e1154d745faecf8"
        };
        
        let app, auth, db;
        
        // Firebase ì´ˆê¸°í™”
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            addResult('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ!', 'success');
        } catch (error) {
            addResult(`âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
        }
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
            
            // ìŠ¤í¬ë¡¤ì„ ì•„ë˜ë¡œ
            div.scrollIntoView({ behavior: 'smooth' });
        }
        
        // ì¸ì¦ ì„¤ì • í™•ì¸
        window.checkAuthConfig = async function() {
            addResult('ğŸ” Firebase Authentication ì„¤ì • í™•ì¸ ì¤‘...');
            
            try {
                // í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
                addResult(`ğŸ“Š í˜„ì¬ ìƒíƒœ:
- í”„ë¡œì íŠ¸ ID: ${app.options.projectId}
- ì¸ì¦ ë„ë©”ì¸: ${app.options.authDomain}
- API í‚¤: ${app.options.apiKey.substring(0, 20)}...`);
                
                // Auth ê°ì²´ ìƒíƒœ í™•ì¸
                if (auth) {
                    addResult('âœ… Auth ê°ì²´ ìƒì„± ì„±ê³µ');
                    addResult(`ğŸ”§ Auth ì„¤ì •:
- App: ${auth.app.name}
- í˜„ì¬ ì‚¬ìš©ì: ${auth.currentUser ? auth.currentUser.email : 'ì—†ìŒ'}`);
                } else {
                    addResult('âŒ Auth ê°ì²´ ìƒì„± ì‹¤íŒ¨', 'error');
                }
                
                // Firestore ê°ì²´ ìƒíƒœ í™•ì¸
                if (db) {
                    addResult('âœ… Firestore ê°ì²´ ìƒì„± ì„±ê³µ');
                } else {
                    addResult('âŒ Firestore ê°ì²´ ìƒì„± ì‹¤íŒ¨', 'error');
                }
                
                addResult('ğŸ’¡ ì§„ë‹¨ ì™„ë£Œ. ë¬¸ì œê°€ ìˆë‹¤ë©´ Firebase Consoleì—ì„œ ì„œë¹„ìŠ¤ë¥¼ í™œì„±í™”í•˜ì„¸ìš”.', 'warning');
                
            } catch (error) {
                addResult(`âŒ ì„¤ì • í™•ì¸ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì§ì ‘ ì¸ì¦ ì‹œë„
        window.tryDirectAuth = async function() {
            addResult('ğŸ§ª ì§ì ‘ ì¸ì¦ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // ì„ì‹œ í…ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ì‹œë„
            const testEmail = `test${Date.now()}@example.com`;
            const testPassword = 'test123456';
            
            try {
                addResult(`ğŸ”„ í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„± ì‹œë„: ${testEmail}`);
                
                const userCredential = await createUserWithEmailAndPassword(auth, testEmail, testPassword);
                
                addResult('âœ… í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„± ì„±ê³µ!', 'success');
                addResult(`ğŸ‘¤ ìƒì„±ëœ ì‚¬ìš©ì UID: ${userCredential.user.uid}`);
                
                // ë°”ë¡œ ë¡œê·¸ì•„ì›ƒ
                await signOut(auth);
                addResult('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                
                // ì´ë²ˆì—ëŠ” ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹œë„
                await createAdminAccount();
                
            } catch (error) {
                let diagnosis = '';
                
                switch (error.code) {
                    case 'auth/configuration-not-found':
                        diagnosis = `
âŒ Authentication ì„œë¹„ìŠ¤ê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!

ğŸ”§ í•´ê²° ë°©ë²•:
1. Firebase Consoleì— ì ‘ì†í•˜ì„¸ìš”
2. Authentication â†’ Sign-in method íƒ­
3. Email/Password ë¡œê·¸ì¸ ë°©ë²•ì„ í™œì„±í™”í•˜ì„¸ìš”

ğŸ“± Firebase Console: https://console.firebase.google.com/project/kdv-sys/authentication/providers`;
                        break;
                        
                    case 'auth/operation-not-allowed':
                        diagnosis = `
âŒ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤!

ğŸ”§ í•´ê²° ë°©ë²•:
Firebase Console â†’ Authentication â†’ Sign-in methodì—ì„œ 
Email/Password í•­ëª©ì„ í™œì„±í™”í•˜ì„¸ìš”.`;
                        break;
                        
                    default:
                        diagnosis = `
âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜: ${error.code}
ë©”ì‹œì§€: ${error.message}`;
                }
                
                addResult(diagnosis, 'error');
            }
        }
        
        // ê´€ë¦¬ì ê³„ì • ìƒì„±
        async function createAdminAccount() {
            try {
                addResult('ğŸ‘‘ ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹œë„...');
                
                const userCredential = await createUserWithEmailAndPassword(
                    auth, 
                    'man4korea@gmail.com', 
                    'dmlwjdqn@Wkd24'
                );
                
                addResult('âœ… ê´€ë¦¬ì ê³„ì • ìƒì„± ì„±ê³µ!', 'success');
                
                // í”„ë¡œí•„ ì €ì¥
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    email: 'man4korea@gmail.com',
                    securityLevel: '1ê¸‰',
                    isAdmin: true,
                    createdAt: serverTimestamp(),
                    lastLoginAt: null
                });
                
                addResult('âœ… ê´€ë¦¬ì í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!', 'success');
                addResult('ğŸ‰ ì´ì œ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ man4korea@gmail.comìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!', 'success');
                
                // ë¡œê·¸ì•„ì›ƒ
                await signOut(auth);
                
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    addResult('âœ… ê´€ë¦¬ì ê³„ì •ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤! ë°”ë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•´ë³´ì„¸ìš”.', 'success');
                } else {
                    addResult(`âŒ ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹¤íŒ¨: ${error.code} - ${error.message}`, 'error');
                }
            }
        }
        
        // ìˆ˜ë™ ì„¤ì • ê°€ì´ë“œ í‘œì‹œ
        window.showManualSteps = function() {
            const manualSteps = document.getElementById('manualSteps');
            if (manualSteps.style.display === 'none') {
                manualSteps.style.display = 'block';
                addResult('ğŸ“‹ ìˆ˜ë™ ì„¤ì • ê°€ì´ë“œë¥¼ í‘œì‹œí–ˆìŠµë‹ˆë‹¤. ì•„ë˜ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.', 'warning');
            } else {
                manualSteps.style.display = 'none';
            }
        }
        
        // ê²°ê³¼ ì§€ìš°ê¸°
        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkAuthConfig, 1000);
        });
    </script>
</body>
</html>