<!DOCTYPE html>
<html lang="ko">
<!-- ğŸ“ admin/cleanup-test-data.html
     í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ë„êµ¬
     Create at 250524_2110 Ver1.00 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .keep { border-left: 4px solid #28a745; }
        .delete { border-left: 4px solid #dc3545; }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #c82333; }
        button.safe { background: #28a745; }
        button.safe:hover { background: #218838; }
        .collection-list {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§¹ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ë„êµ¬</h1>
    
    <div class="card keep">
        <h3>âœ… ìœ ì§€í•  ìš´ì˜ ë°ì´í„°</h3>
        <div class="collection-list">ğŸ“ departments - ë¶€ì„œ ë§ˆìŠ¤í„° ë°ì´í„°
ğŸ‘¥ employees - ì§ì› ì •ë³´  
ğŸ”’ employee_private - ì§ì› ë¯¼ê°ì •ë³´
ğŸ‘¤ users - ì‚¬ìš©ì ê³„ì •
ğŸ“‹ system_logs - ì‹œìŠ¤í…œ ë¡œê·¸</div>
        <p><strong>âš ï¸ ì´ ë°ì´í„°ë“¤ì€ ì ˆëŒ€ ì‚­ì œí•˜ì§€ ë§ˆì„¸ìš”!</strong></p>
    </div>
    
    <div class="card delete">
        <h3>ğŸ—‘ï¸ ì‚­ì œ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„°</h3>
        <div class="collection-list">ğŸ§ª simple-test - ì—°ê²° í…ŒìŠ¤íŠ¸ìš©
ğŸ§ª test - ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ìš©</div>
        <div class="status info" id="cleanupStatus">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ëŒ€ê¸° ì¤‘...</div>
        <button onclick="cleanupTestData()">ğŸ—‘ï¸ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ</button>
        <button class="safe" onclick="checkCollections()">ğŸ“Š í˜„ì¬ ì»¬ë ‰ì…˜ í™•ì¸</button>
    </div>
    
    <div class="card">
        <h3>ğŸ“‹ ì •ë¦¬ ê°€ì´ë“œë¼ì¸</h3>
        <p><strong>ê°œë°œ ì™„ë£Œ í›„ ì •ë¦¬ ì‹œì :</strong></p>
        <ul>
            <li>ğŸ¯ ê¸°ëŠ¥ ê°œë°œì´ ì™„ì „íˆ ëë‚œ í›„</li>
            <li>ğŸ§ª ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•œ í›„</li>
            <li>ğŸš€ ìš´ì˜ ë°°í¬ ì§ì „</li>
        </ul>
        
        <p><strong>ì •ë¦¬ ë°©ë²•:</strong></p>
        <ol>
            <li>ì´ ë„êµ¬ë¡œ í…ŒìŠ¤íŠ¸ ì»¬ë ‰ì…˜ë§Œ ì‚­ì œ</li>
            <li>Firebase Consoleì—ì„œ ìˆ˜ë™ í™•ì¸</li>
            <li>ìš´ì˜ ë°ì´í„° ë°±ì—… ìƒì„±</li>
        </ol>
    </div>

    <!-- Firebase v9+ modular SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            doc,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAfSlSi4pNlKvMU-NBpQ3ZWSeG4QNpZiCk",
            authDomain: "kdv-sys.firebaseapp.com",
            projectId: "kdv-sys",
            storageBucket: "kdv-sys.firebasestorage.app",
            messagingSenderId: "352925761129",
            appId: "1:352925761129:web:a9c9cf2e1154d745faecf8"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // í˜„ì¬ ì»¬ë ‰ì…˜ í™•ì¸
        window.checkCollections = async function() {
            const statusEl = document.getElementById('cleanupStatus');
            statusEl.className = 'status info';
            statusEl.textContent = 'ğŸ“Š ì»¬ë ‰ì…˜ í™•ì¸ ì¤‘...';
            
            try {
                const collections = ['departments', 'employees', 'employee_private', 'users', 'system_logs', 'simple-test', 'test'];
                const results = [];
                
                results.push('ğŸ“Š í˜„ì¬ ì»¬ë ‰ì…˜ ìƒíƒœ:');
                results.push('');
                
                for (const collName of collections) {
                    try {
                        const snapshot = await getDocs(collection(db, collName));
                        const status = snapshot.size > 0 ? 'âœ…' : 'ğŸ“­';
                        const type = ['simple-test', 'test'].includes(collName) ? 'ğŸ§ª' : 'ğŸ“';
                        results.push(`${status} ${type} ${collName}: ${snapshot.size}ê°œ ë¬¸ì„œ`);
                    } catch (error) {
                        results.push(`âŒ ${collName}: ì ‘ê·¼ ë¶ˆê°€`);
                    }
                }
                
                statusEl.className = 'status success';
                statusEl.textContent = results.join('\\n');
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ ì»¬ë ‰ì…˜ í™•ì¸ ì‹¤íŒ¨: ${error.message}`;
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
        window.cleanupTestData = async function() {
            if (!confirm('âš ï¸ í…ŒìŠ¤íŠ¸ ì»¬ë ‰ì…˜ (simple-test, test)ì„ ì‚­ì œí•©ë‹ˆë‹¤.\\n\\nìš´ì˜ ë°ì´í„°ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.\\n\\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const statusEl = document.getElementById('cleanupStatus');
            statusEl.className = 'status info';
            statusEl.textContent = 'ğŸ§¹ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì¤‘...';
            
            try {
                const results = [];
                const testCollections = ['simple-test', 'test'];
                
                for (const collName of testCollections) {
                    try {
                        results.push(`ğŸ—‘ï¸ ${collName} ì»¬ë ‰ì…˜ ì •ë¦¬ ì¤‘...`);
                        
                        const snapshot = await getDocs(collection(db, collName));
                        
                        if (snapshot.empty) {
                            results.push(`ğŸ“­ ${collName}: ì´ë¯¸ ë¹„ì–´ìˆìŒ`);
                            continue;
                        }
                        
                        // ê° ë¬¸ì„œ ì‚­ì œ
                        let deletedCount = 0;
                        for (const docSnapshot of snapshot.docs) {
                            await deleteDoc(doc(db, collName, docSnapshot.id));
                            deletedCount++;
                        }
                        
                        results.push(`âœ… ${collName}: ${deletedCount}ê°œ ë¬¸ì„œ ì‚­ì œ ì™„ë£Œ`);
                        
                    } catch (error) {
                        results.push(`âŒ ${collName} ì‚­ì œ ì‹¤íŒ¨: ${error.message}`);
                    }
                }
                
                results.push('');
                results.push('ğŸ‰ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ!');
                results.push('ìš´ì˜ ë°ì´í„°ëŠ” ëª¨ë‘ ì•ˆì „í•˜ê²Œ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                statusEl.className = 'status success';
                statusEl.textContent = results.join('\\n');
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkCollections, 1000);
        });
    </script>
</body>
</html>