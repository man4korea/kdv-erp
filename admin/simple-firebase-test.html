<!DOCTYPE html>
<html lang="ko">
<!-- ğŸ“ admin/simple-firebase-test.html
     Firebase ê°„ë‹¨ í…ŒìŠ¤íŠ¸ - í•µì‹¬ ë¬¸ì œ ì§„ë‹¨ìš©
     Create at 250524_2100 Ver1.00 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase ê°„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 700px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .result {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebase ê°„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
    <p>í•µì‹¬ ë¬¸ì œë§Œ ì§„ë‹¨í•©ë‹ˆë‹¤.</p>
    
    <button onclick="testBasic()">ğŸš€ ê¸°ë³¸ í…ŒìŠ¤íŠ¸</button>
    <button onclick="testWrite()">ğŸ“ ì“°ê¸° í…ŒìŠ¤íŠ¸</button>
    <button onclick="checkProject()">ğŸ” í”„ë¡œì íŠ¸ í™•ì¸</button>
    
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDocs, 
            setDoc
        } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAfSlSi4pNlKvMU-NBpQ3ZWSeG4QNpZiCk",
            authDomain: "kdv-sys.firebaseapp.com",
            projectId: "kdv-sys",
            storageBucket: "kdv-sys.firebasestorage.app",
            messagingSenderId: "352925761129",
            appId: "1:352925761129:web:a9c9cf2e1154d745faecf8"
        };
        
        let app, db;
        
        function addResult(message, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }
        
        // ê¸°ë³¸ í…ŒìŠ¤íŠ¸
        window.testBasic = async function() {
            try {
                addResult('ğŸš€ Firebase ì´ˆê¸°í™” ì‹œì‘...');
                
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                addResult(`âœ… ì´ˆê¸°í™” ì„±ê³µ!
í”„ë¡œì íŠ¸ ID: ${app.options.projectId}
ì•± ì´ë¦„: ${app.name}`);
                
                // ë¹ˆ ì»¬ë ‰ì…˜ ì½ê¸° ì‹œë„
                addResult('ğŸ“– ë¹ˆ ì»¬ë ‰ì…˜ ì½ê¸° í…ŒìŠ¤íŠ¸...');
                const emptyRef = collection(db, 'empty-test');
                const snapshot = await getDocs(emptyRef);
                
                addResult(`âœ… ì½ê¸° ì„±ê³µ! ë¬¸ì„œ ê°œìˆ˜: ${snapshot.size}`);
                
            } catch (error) {
                addResult(`âŒ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:
ì—ëŸ¬: ${error.message}
ì½”ë“œ: ${error.code}
ìŠ¤íƒ: ${error.stack}`, true);
            }
        }
        
        // ì“°ê¸° í…ŒìŠ¤íŠ¸
        window.testWrite = async function() {
            if (!db) {
                addResult('âš ï¸ ë¨¼ì € ê¸°ë³¸ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.', true);
                return;
            }
            
            try {
                addResult('ğŸ“ ì“°ê¸° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                
                const testDoc = doc(db, 'simple-test', 'test-doc');
                await setDoc(testDoc, {
                    message: 'í…ŒìŠ¤íŠ¸ ì„±ê³µ',
                    timestamp: new Date().toISOString()
                });
                
                addResult('âœ… ì“°ê¸° í…ŒìŠ¤íŠ¸ ì„±ê³µ!');
                
            } catch (error) {
                addResult(`âŒ ì“°ê¸° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:
ì—ëŸ¬: ${error.message}
ì½”ë“œ: ${error.code}

ğŸ’¡ í•´ê²° ë°©ë²•:
${error.code === 'permission-denied' ? 
  '- Firestore ë³´ì•ˆ ê·œì¹™ í™•ì¸' : 
  error.code === 'unavailable' ? 
  '- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸\n- Firestore ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸' :
  '- Firebase í”„ë¡œì íŠ¸ ì„¤ì • í™•ì¸\n- API í‚¤ ê¶Œí•œ í™•ì¸'}`, true);
            }
        }
        
        // í”„ë¡œì íŠ¸ ì„¤ì • í™•ì¸
        window.checkProject = async function() {
            addResult(`ğŸ” í”„ë¡œì íŠ¸ ì„¤ì • í™•ì¸:

í”„ë¡œì íŠ¸ ID: ${firebaseConfig.projectId}
API í‚¤: ${firebaseConfig.apiKey.substring(0, 15)}...
ì¸ì¦ ë„ë©”ì¸: ${firebaseConfig.authDomain}
í˜„ì¬ URL: ${window.location.href}
ë¸Œë¼ìš°ì €: ${navigator.userAgent.split(' ').pop()}

âœ… í™•ì¸í•´ì•¼ í•  ì‚¬í•­:
1. Firebase Console â†’ Firestore Database í™œì„±í™”
2. ë³´ì•ˆ ê·œì¹™: allow read, write: if true
3. API í‚¤ ê¶Œí•œì— Cloud Firestore API í¬í•¨
4. ë„ë©”ì¸ ì œí•œ ì—†ìŒ (ë˜ëŠ” localhost í—ˆìš©)`);
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            addResult('ğŸ§ª ê°„ë‹¨ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            setTimeout(testBasic, 1000);
        });
    </script>
</body>
</html>