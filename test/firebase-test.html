<!DOCTYPE html>
<html lang="ko">
<!-- ğŸ“ firebase-test.html
     KDV ì‹œìŠ¤í…œ - Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ í˜ì´ì§€
     Create at 250524_1830 Ver1.00 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ - KDV ERP</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: var(--radius-md);
            font-weight: 500;
        }
        .status.success {
            background-color: var(--bg-success);
            color: var(--success);
        }
        .status.error {
            background-color: var(--bg-danger);
            color: var(--danger);
        }
        .status.loading {
            background-color: var(--bg-info);
            color: var(--info);
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-md);
            font-family: monospace;
            font-size: var(--text-sm);
        }
        .btn-test {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="test-container">
            <h1 class="text-2xl font-bold">ğŸ”¥ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
            <p class="text-secondary">KDV ERP ì‹œìŠ¤í…œì˜ Firebase ì„¤ì •ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            
            <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
            <div id="connectionStatus" class="status loading">
                â³ Firebase ì—°ê²°ì„ í™•ì¸í•˜ëŠ” ì¤‘...
            </div>
            
            <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ -->
            <button id="testBtn" class="btn btn-primary btn-test" onclick="runFirebaseTest()">
                ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸ ë‹¤ì‹œ ì‹¤í–‰
            </button>
            
            <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="testResults" class="test-results" style="display: none;">
                <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- í™˜ê²½ ì •ë³´ -->
            <div class="card" style="margin-top: 30px;">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“‹ í™˜ê²½ ì •ë³´</h2>
                </div>
                <div id="envInfo">
                    <!-- JavaScriptë¡œ í™˜ê²½ ì •ë³´ê°€ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK ë° ì„¤ì • ë¡œë“œ -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAfSlSi4pNlKvMU-NBpQ3ZWSeG4QNpZiCk",
            authDomain: "kdv-sys.firebaseapp.com",
            projectId: "kdv-sys",
            storageBucket: "kdv-sys.firebasestorage.app",
            messagingSenderId: "352925761129",
            appId: "1:352925761129:web:a9c9cf2e1154d745faecf8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        
        // Import and initialize other Firebase services
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ Firebase ê°ì²´ ì„¤ì •
        window.firebaseApp = app;
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        /**
         * Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
         */
        window.runFirebaseTest = async function() {
            const statusEl = document.getElementById('connectionStatus');
            const resultsEl = document.getElementById('testResults');
            const testBtn = document.getElementById('testBtn');
            
            // í…ŒìŠ¤íŠ¸ ì‹œì‘
            statusEl.className = 'status loading';
            statusEl.innerHTML = 'â³ Firebase ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì¤‘...';
            testBtn.disabled = true;
            
            let testResults = [];
            testResults.push('ğŸ” Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testResults.push('ì‹œê°„: ' + new Date().toLocaleString('ko-KR'));
            testResults.push('----------------------------------------');
            
            try {
                // 1. Firebase App ì´ˆê¸°í™” í™•ì¸
                if (app) {
                    testResults.push('âœ… Firebase App ì´ˆê¸°í™” ì„±ê³µ');
                    testResults.push('   í”„ë¡œì íŠ¸ ID: ' + app.options.projectId);
                } else {
                    throw new Error('Firebase App ì´ˆê¸°í™” ì‹¤íŒ¨');
                }
                
                // 2. Firestore ì—°ê²° í™•ì¸
                if (db) {
                    testResults.push('âœ… Firestore ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ');
                } else {
                    throw new Error('Firestore ì—°ê²° ì‹¤íŒ¨');
                }
                
                // 3. Authentication í™•ì¸
                if (auth) {
                    testResults.push('âœ… Firebase Authentication ì—°ê²° ì„±ê³µ');
                    testResults.push('   ì¸ì¦ ë„ë©”ì¸: ' + auth.config.authDomain);
                } else {
                    throw new Error('Firebase Authentication ì—°ê²° ì‹¤íŒ¨');
                }
                
                // 4. ì‹¤ì œ ì—°ê²° ìƒíƒœ í™•ì¸
                // checkFirebaseConnection í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                // const isConnected = await checkFirebaseConnection();
                
                // if (isConnected) {
                //     testResults.push('âœ… Firebase ì‹¤ì œ ì—°ê²° ìƒíƒœ ì–‘í˜¸');
                // } else {
                //     testResults.push('âš ï¸ Firebase ì—°ê²° ìƒíƒœ ë¶ˆì•ˆì •');
                // }
                
                // í…ŒìŠ¤íŠ¸ ì„±ê³µ
                statusEl.className = 'status success';
                statusEl.innerHTML = 'âœ… Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!';
                testResults.push('----------------------------------------');
                testResults.push('ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!');
                
            } catch (error) {
                // í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
                statusEl.className = 'status error';
                statusEl.innerHTML = 'âŒ Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message;
                testResults.push('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                testResults.push('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ' + error.stack);
            }
            
            // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
            resultsEl.innerHTML = testResults.join('\\n');
            resultsEl.style.display = 'block';
            testBtn.disabled = false;
        };
        
        /**
         * í™˜ê²½ ì •ë³´ ë¡œë“œ
         */
        function loadEnvironmentInfo() {
            const envInfoEl = document.getElementById('envInfo');
            
            const envData = [
                'ğŸŒ ë¸Œë¼ìš°ì €: ' + navigator.userAgent.split(' ').pop(),
                'ğŸ  í˜¸ìŠ¤íŠ¸: ' + window.location.hostname,
                'ğŸ“ í¬íŠ¸: ' + (window.location.port || 'ê¸°ë³¸ê°’'),
                'ğŸ”’ í”„ë¡œí† ì½œ: ' + window.location.protocol,
                'ğŸ“± í”Œë«í¼: ' + navigator.platform,
                'ğŸ• íƒ€ì„ì¡´: ' + Intl.DateTimeFormat().resolvedOptions().timeZone
            ];
            
            envInfoEl.innerHTML = envData.map(info => '<p class="text-sm">' + info + '</p>').join('');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            loadEnvironmentInfo();
            runFirebaseTest();
        });
        
        // ê°œë°œ ëª¨ë“œì—ì„œ ì¶”ê°€ ì •ë³´ ì¶œë ¥
        if (window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1')) {
            console.log('ğŸ› ï¸ ê°œë°œ ëª¨ë“œì—ì„œ ì‹¤í–‰ ì¤‘');
            // logEnvironmentInfo í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            // logEnvironmentInfo();
        }
    </script>
</body>
</html>